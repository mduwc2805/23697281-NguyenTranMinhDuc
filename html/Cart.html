<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gi·ªè h√†ng</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" href="../css/all.css">
    <!-- js -->
    <script src="../js/jquery-3.7.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/myJS.js"></script>
</head>
<body>
  <!-- navbar -->
  <nav class="navbar navbar-expand-xl sticky-top mb-4" style="background-color: black;">
        
    <div class="navbar-logo">
        <a href="../html/TrangChu.html">
            <img src="../img/logo.png" alt="logo" style="width: 70x; height: 70px;">
            <span>Super Glasses</span>
        </a>
    </div>

    
    <div class="navbar-toggler" data-toggle="collapse" data-target="#navbar-nav" >
        <i class="fa-solid fa-bars"></i>
    </div>
    
    
    <div class="collapse navbar-collapse" id="navbar-nav">
        <ul class="navbar-nav">

            <li class="TrangChu">
                <a class="" href="../html/TrangChu.html">
                    <i class="fa fa-home"></i>
                    TRANG CH·ª¶
                </a>
            </li>

            <li class="GioiThieu">
                <a class="" href="../html/GioiThieu.html">
                    <i class="fa fa-shop" ></i>
                    GI·ªöI THI·ªÜU
                </a>
            </li>

            <li class="SanPham">
                <a id="SanPham" href="../html/SanPham.html" data-toggle="dropdown">
                    <i class="fa fa-list" ></i>
                    S·∫¢N PH·∫®M    
                </a>
                <div class="position-relative">
                    <div class="dropdownSanPham">
                        <div class="row">
                            <div class="col-xl-3 col-6">
                                <div class="card-info">
                                    <h5>K√çNH M√ÅT</h5>
                                    <hr>
                                    <div><a href="../html/SanPham.html">K√≠nh M√°t Nam</a></div>
                                    <div><a href="../html/SanPham.html">K√≠nh M√°t N·ªØ</a></div>
                                    <div><a href="../html/SanPham.html">K√≠nh Th·ªÉ Thao</a></div>
                                    <div class="banner3"></div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-6">
                                <div class="card-info">
                                    <h5>TR√íNG K√çNH</h5>
                                    <hr>
                                    <div><a href="../html/SanPham.html">Tr√≤ng K√≠nh Ch·ªëng √Ånh S√°ng Xanh</a></div>
                                    <div><a href="../html/SanPham.html">Tr√≤ng K√≠nh ƒê·ªïi M√†u</a></div>
                                    <div><a href="../html/SanPham.html">ƒêa Tr√≤ng</a></div>
                                    <div class="banner4"></div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-6">
                                <div class="card-info">
                                    <h5>G·ªåNG K√çNH</h5>
                                    <hr>
                                    <div><a href="../html/SanPham.html">G·ªçng K√≠nh N·ª≠a Khung</a></div>
                                    <div><a href="../html/SanPham.html">G·ªçng K√≠nh Khoan</a></div>
                                    <div><a href="../html/SanPham.html">G·ªçng K√≠nh Titan</a></div>
                                    <div class="banner5"></div>
                                </div>
                            </div>
                            <div class="col-xl-3 col-6">
                                <div class="card-info">
                                    <h5>K√çNH √ÅP TR√íNG</h5>
                                    <hr>
                                    <div><a href="../html/SanPham.html">K√≠nh √Åp Tr√≤ng Kh√¥ng M√†u</a></div>
                                    <div><a href="../html/SanPham.html">K√≠nh √Åp Tr√≤ng M√†u</a></div>
                                    <br>
                                    <h5>K√çNH TR·∫∫ EM</h5>
                                    <hr>
                                    <div><a href="../html/SanPham.html">G·ªçng K√≠nh Tr·∫ª Em</a></div>
                                    <div><a href="../html/SanPham.html">K√≠nh M√°t Tr·∫ª Em</a></div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </li>
            
            
            
            <li class="LienHe">
                <a class="" href="#">
                    <i class="fa fa-shop" ></i>
                    LI√äN H·ªÜ
                </a>
            </li>

            <li id="DangKy" style="color: white;">
                <a class="" href="../html/DangKy.html">
                    <i class="fa-solid fa-user"></i>
                </a>
            </li>

            <li class="GioHang active">
                <a class="" href="../html/Cart.html">
                    <i class="fa-solid fa-cart-shopping"></i>
                </a>
            </li>

            <form id="search-box">
                <input id="search-input" type="text" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m...">
                <button type="submit">
                    <i class="fas fa-search"></i>
                </button>
            </form>

            <li class="DangXuat">
                <button id="logoutButton" class="btn" style="display: none; color: white; padding: 0px;">ƒêƒÉng xu·∫•t!</button>
            </li>
            
        </ul>
    </div>
  </nav>

  <!-- Cart -->
  <h2 class="p-4">Gi·ªè h√†ng c·ªßa b·∫°n</h2>
  <div class="pl-4" id="cart-items"></div>
  <h3 class="pl-4" id="total"></h3>
  <button class="btn btn-danger ml-4" onclick="clearCart()">üóë X√≥a to√†n b·ªô gi·ªè h√†ng</button>
  <a class="btn btn-outline-primary" href="../html/SanPham.html">‚Üê Quay l·∫°i mua h√†ng</a>

  <!-- Thanh to√°n -->
  
<!-- N√∫t ƒë·ªÉ m·ªü Modal -->
  <div>
    <button id="paymentButton" class="btn btn-outline-info ml-4 mt-2" data-toggle="modal" data-target="#paymentModal">Thanh to√°n</button>
  </div>
<!-- Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" role="dialog" aria-labelledby="paymentModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="paymentModalLabel">Th√¥ng tin thanh to√°n</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="ƒê√≥ng">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="paymentForm">
          <div class="form-group">
            <label for="fullname">H·ªç v√† t√™n</label>
            <input type="text" class="form-control" id="fullname" placeholder="Nguy·ªÖn VƒÉn A" required>
            <div id="fullnameError" class="error"></div>
          </div>

          <div class="form-group">
            <label for="phone">S·ªë ƒëi·ªán tho·∫°i</label>
            <input type="tel" class="form-control" id="phone" placeholder="0123456789" required>
            <div id="phoneError" class="error"></div>
          </div>

          <div class="form-group">
            <label for="address">ƒê·ªãa ch·ªâ</label>
            <input type="text" class="form-control" id="address" required>
            <div id="addressError" class="error"></div>
          </div>

          <div class="form-group">
            <label for="paymentMethod">Ph∆∞∆°ng th·ª©c thanh to√°n</label>
            <select class="form-control" id="paymentMethod" required>
              <option value="">Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n</option>
              <option value="cash">Ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</option>
              <option value="bank">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</option>
              <option value="creditCard">Thanh to√°n qua th·∫ª t√≠n d·ª•ng</option>
            </select>
            <div id="paymentMethodError" class="error"></div>
          </div>

          <div class="form-group">
            <label for="note">Ghi ch√∫ (kh√¥ng b·∫Øt bu·ªôc)</label>
            <textarea class="form-control" id="note" rows="3"></textarea>
          </div>

          <div id="modal-total">
            <p>Th√†nh Ti·ªÅn: <span id="modal-total-amount">0 VND</span></p>
          </div>

          <button type="submit" class="btn btn-outline-info btn-block">X√°c nh·∫≠n thanh to√°n</button>
        </form>
      </div>
    </div>
  </div>
</div>

  <!-- footer -->
  <footer class="row" style="margin-top: 100px;">
    <div class="col-xl-7 col-12">
        <div class="row">
            <div class="logo-footer col-12"><img src="../img/logo.png" alt="" height="100px" width="100px"></div>
        </div>

        <div class="row">
            <div class="col-12" style="color: white; padding-left: 10%; padding-top: 5%; font-size: large; font-weight: 600;">ƒêƒÉng k√≠ ƒë·ªÉ nh·∫≠n tin m·ªõi nh·∫•t</div>
        </div>

        <div class="row">
            <div class="inputEmail col-12">
                <input type="text" placeholder="ƒê·ªÉ l·∫°i email c·ªßa b·∫°n">
                <i class="fa-solid fa-arrow-up-long" style=" background-color: #eee; color: orange; padding: 20px; border-radius: 100px; cursor: pointer;"></i>
            </div>
        </div>

        <div class="row">
            <div class="col-12" style="padding-left: 10%;">
                <i class="fa-brands fa-facebook"></i>
                <i class="fa-brands fa-instagram"></i>
                <i class="fa-brands fa-tiktok"></i>
            </div>
        </div>
    </div>

    <div class="col-xl-2 col-12 pl-5">
        <div class="title-footer">S·∫¢N PH·∫®M</div>
        <div class="info-footer">
            <div><a href="#">The TiTan</a></div>
            <div><a href="#">G·ªçng K√≠nh</a></div>
            <div><a href="#">Tr√≤ng K√≠nh</a></div>
            <div><a href="#">K√≠nh R√¢m</a></div>
            <div><a href="#">K√≠nh r√¢m tr·∫ª em</a></div>
        </div>

        <div class="title-footer">CH√çNH S√ÅCH MUA H√ÄNG</div>
        <div class="info-footer">
            <div><a href="#">H√¨nh th·ª©c thanh to√°n</a></div>
            <div><a href="#">Ch√≠nh s√°ch giao h√†ng</a></div>
            <div><a href="#">Chinh s√°ch b·∫£o h√†nh</a></div>

        </div>
    </div>

    <div class="col-xl-2 col-12 pl-5">
        <div class="title-footer">TH√îNG TIN LI√äN H·ªÜ</div>
        <div class="info-footer">
            <div><a href="">1900xxxx</a></div>
            <div><a href="">marketing@superglasses.com</a></div>
        </div>
    </div>
</footer>
<img src="" alt="">
  <script>
    function renderCart() {
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const cartContainer = $("#cart-items");
  cartContainer.html("");

  const paymentButton = $("#paymentButton");

  const isLoggedIn = localStorage.getItem("isLoggedIn"); 

  if (cart.length === 0) {
    cartContainer.html("<p>Gi·ªè h√†ng tr·ªëng.</p>");
    $("#total").text("");
    paymentButton.prop('disabled', true); 
    return;
  }

  let total = 0;

  cart.forEach((item, index) => {
    const itemTotal = item.price * item.quantity;
    total += itemTotal;

    const html = `
      <div class="cart-item" data-id="${item.id}">
        <img src="${item.image}" width="150px" height="150px" style="border-radius: 20px; margin-bottom: 10px" />
        <h4>${item.name}</h4>
        <p>Gi√°: ${item.price.toLocaleString()} VND</p>
        <div class="quantity-controls">
          <button class="btn btn-outline-light" onclick="updateQuantity('${item.id}', -1)">‚ûñ</button>
          ${item.quantity}
          <button class="btn btn-outline-light" onclick="updateQuantity('${item.id}', 1)">‚ûï</button>
        </div>
        <p>Th√†nh ti·ªÅn: ${itemTotal.toLocaleString()} VND</p>
        <button class="btn btn-outline-info" onclick="removeItem('${item.id}')">‚ùå X√≥a</button>
        <hr>
      </div>
    `;
    cartContainer.append(html);
  });

  $("#total").text("T·ªïng ti·ªÅn: " + total.toLocaleString() + " VND");

  $("#modal-total-amount").text(total.toLocaleString() + " VND");

  if (!isLoggedIn) {
    alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c.");
  } else {
    if (total > 0) {
      paymentButton.prop('disabled', false);
    }
  }
}


$("#paymentButton").click(function() {
  const isLoggedIn = localStorage.getItem("isLoggedIn"); 

  if (!isLoggedIn) {
    alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c thanh to√°n."); 
    window.location.href = "../html/DangNhap.html"; 
  } else {
    
    $('#paymentModal').modal('show'); 
  }
});

function updateQuantity(id, delta) {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  const item = cart.find(i => i.id === id);
  if (!item) return;

  item.quantity += delta;
  if (item.quantity <= 0) {
    cart = cart.filter(i => i.id !== id);
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function removeItem(id) {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  cart = cart.filter(item => item.id !== id);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function clearCart() {
  if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô gi·ªè h√†ng?")) {
    localStorage.removeItem("cart");
    renderCart();
  }
}

$(document).ready(function() {
  renderCart();
});

document.getElementById("paymentForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const fullname = document.getElementById("fullname").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const paymentMethod = document.getElementById("paymentMethod").value;

  const fullnameError = document.getElementById("fullnameError");
  const phoneError = document.getElementById("phoneError");
  const addressError = document.getElementById("addressError");
  const paymentMethodError = document.getElementById("paymentMethodError");

  fullnameError.textContent = "";
  phoneError.textContent = "";
  addressError.textContent = "";
  paymentMethodError.textContent = "";

  let isValid = true;

  const fullnameRegex = /^([A-Z√Ä-·ª¥][a-z√†-·ªπ]+)(\s[A-Z√Ä-·ª¥][a-z√†-·ªπ]+)+$/;
  if (!fullnameRegex.test(fullname)) {
    fullnameError.textContent = "H·ªç t√™n ph·∫£i vi·∫øt hoa ch·ªØ c√°i ƒë·∫ßu m·ªói t·ª´ (VD: Nguy·ªÖn VƒÉn A)";
    isValid = false;
  }

  const phoneRegex = /^0\d{9}$/;
  if (!phoneRegex.test(phone)) {
    phoneError.textContent = "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá (ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng 0 v√† c√≥ 10 ch·ªØ s·ªë)";
    isValid = false;
  }

  if (address === "") {
    addressError.textContent = "Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ.";
    isValid = false;
  }

  if (paymentMethod === "") {
    paymentMethodError.textContent = "Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n.";
    isValid = false;
  }

  if (isValid) {
    alert("Th√¥ng tin thanh to√°n h·ª£p l·ªá!\nC·∫£m ∆°n b·∫°n ƒë√£ ƒë·∫∑t h√†ng.");
    document.getElementById("paymentForm").reset();
    $('#paymentModal').modal('hide'); 
  }
});

  // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p khi v√†o trang
  window.onload = function () {
        const isLoggedIn = localStorage.getItem("isLoggedIn");

        if (isLoggedIn === "true") {
            const currentUser = JSON.parse(localStorage.getItem("currentUser"));
            
            const dangKyElement = document.getElementById("DangKy");
            const logoutButton = document.getElementById("logoutButton");
            if (currentUser) {
                dangKyElement.innerHTML = `Ch√†o ${currentUser.username}!`;
            }

            if (logoutButton) {
                logoutButton.style.display = "block";
            }
        }
        };

    
        // X·ª≠ l√Ω s·ª± ki·ªán ƒëƒÉng xu·∫•t
        const logoutBtn = document.getElementById("logoutButton");

        if (logoutBtn) {
        logoutBtn.addEventListener("click", function () {
            localStorage.removeItem("isLoggedIn");
            localStorage.removeItem("currentUser");
            alert("ƒêƒÉng xu·∫•t th√†nh c√¥ng!");
            window.location.href = "DangNhap.html";
        });
        }
    
  </script>
</body>
</html>
